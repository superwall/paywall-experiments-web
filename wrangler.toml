name = "paywall-experiments-web"
main = "src/worker.ts"
compatibility_date = "2024-10-29"
assets = { directory = "./dist", binding = "ASSETS" }

# R2 bucket for storing results and images
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "paywall-experiments"
preview_bucket_name = "paywall-experiments-preview"

# D1 database for storing emails
[[d1_databases]]
binding = "DB"
database_name = "paywall-experiments-db"
database_id = "1d2af265-365c-4cd9-b9ab-760be4d2f1f9"

# Environment variables (use wrangler secret for sensitive values)
[vars]
# Add non-sensitive environment variables here
# 
# Required secrets (set via `wrangler secret put <SECRET_NAME>`):
# - TURNSTILE_SECRET_KEY: Cloudflare Turnstile secret key
# - TURNSTILE_SITE_KEY: Cloudflare Turnstile site key (public)
# - EXA_API_KEY: Exa API key for crawling URLs
# - CUSTOMER_IO_SITE_ID and CUSTOMER_IO_API_KEY for Customer.io tracking
# - CUSTOMER_IO_REGION (optional, defaults to US)

# Build configuration
[build]
command = "bun run build:frontend"

# Production environment with custom domain
[env.production]
routes = [
  { pattern = "paywallexperiments.com", custom_domain = true },
  { pattern = "www.paywallexperiments.com", custom_domain = true }
]

# Observability configuration
[observability.logs]
enabled = false
head_sampling_rate = 1
invocation_logs = true
persist = true
